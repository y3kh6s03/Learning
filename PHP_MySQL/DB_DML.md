# DML　データ操作言語

1. レコードの追加
   1. 単一レコードの挿入
   insert into DB名.テーブル名(属性1,属性2) values('値1','値2');
       1. 属性でdefault値やauto_incrementがあれば、指定する必要がない
       2. 数字はシングルクォーテーション不要
   2. 複数レコードの挿入
       1. insert into DB名.テーブル名(属性1,属性2) values('値1','値2'),('値1','値2'),('値1','値2')このように続けて記述すればいい
   3. 外部キー制約がある場合、親テーブルから指定。子テーブルに紐づける情報が必要となるため

2. レコードの取得
   1. select 取得したい属性 as label from テーブル名[as alias]
      1. 取得したい属性:
         *: すべての属性を取得
         count(*): レコード件数を取得
         distinct: 重複レコードを省く
         as: 列ラベルの変更(asは省略可能)
      2. その後に来る as labelに関して
         取得したレコードの値に対してのラベルとなる
         こちらはダブルクォーテーションを使うことがベター

3. レコードの削除
   1. delete from db名.テーブル名;
      指定テーブルのレコードをすべて削除
   2. レコードを削除した時の注意点
      1. auto_incrementは、削除しても1に戻らない
         alter table DB名.テーブル名 auto_increment = 1;
         初期化する必要がある
      2. 削除の注意点
      削除対象のレコードをwhereで指定する
      その条件をコピーして、レコードを削除する
      レコードの間違いを防げる

4. 条件句 where
   1. select 取得したい属性 from DB名.テーブル名　※区切らずに
      where　表示したい条件
      1. = 一致
      2. <> != 非一致
      3. >,>=,<,<= 比較
      4. A and B
      5. A or B
      6. ()で条件を括る　※条件を複雑につなげることが可能になる
      7. like : %で部分一致検索　where name like '店％'
      8. in いずれかの値に一致　where name in ('店舗A','店舗B')
      9. not in いずれかの値に一致しない　where name not in ('店舗A','店舗B')
      10. where 属性　between 60 and 100
      11. is not null null以外のものが返ってくる where 属性 is not null
      12. is nullはnullが返ってくる
5. ソート　order by
   1. select 取得したい属性 from DB名.テーブル名　※区切らずに
      order by 属性　(デフォルトはasc(昇順),desc(降順))
   2. 組み合わせて、利用できることができる

6. limit(取得レコード数) と　offset(取得開始位置);
   1. 取得した条件に追加して記載すればいい
   limit 1 や　limit 3 offset 2(ソートの2番目から3つレコードを取得する)
   2. offsetは省略して記載が可能
      limit 1,2　と記載可能
      ※この場合offset 1, limit 2という意味

7. レコードの更新 update
   1. update db名.テーブル名 set 変更する属性1=値1...
      where 条件指定
   2. 更新の注意点
      変更対象のレコードをwhereで指定する
      その条件をコピーして、レコードを更新する
      レコードの間違いを防げる
   3. 自己代入のように更新をかけることができる
      更新する値 = 更新する値 - 値

8. テーブルの結合
   1. 内部結合　inner join
      2つのテーブルを結合して、双方に存在するレコードを返す
      1. select * from テーブル1
         inner join テーブル2
         on テーブル1,値が一致する属性 = テーブル2,値が一致する属性
   2. 左外部結合 left join
      2つのテーブルを結合して、左側に存在するレコードを返す
   3. 右外部結合 right join
      2つのテーブルを結合して、右側に存在するレコードを返す
   4. 外部結合 outer join(MYSQLでは利用不可)
      2つのテーブルを結合して、存在するレコード全てを返す

9. セキュリティ(SQLインジェクション)
   input欄などからSQLクエリを仕込まれて、意図しない操作を受けること
   1. 対策
      1. プリペアードステートメント
         1. Prepareメソッド
            DB上に値をもたずに、クエリのみを事前準備させる
         2. Bindメソッド
            Prepareのクエリに値を付与する
         3. Executeメソッド
            上記フローを実行させる
            exec,queryメソッドは、インジェクションリスクがあるため本番環境では実装しない
