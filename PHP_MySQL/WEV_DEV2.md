# ログイン/登録機能の実装

##　ログイン
1. ユーザー情報を保持するユーザーモデルのファイルを作成
   1. dbから取得してきた値を保持するためのクラスを作成する。
2. ユーザー情報をDBから取得するクエリファイルを作成
   1. クラスでfetchIDするクラスを作成
   2. DBからデータを取得するクラスを利用して、データ取得のインスタンスを作成
      データの取得結果を雛形のクラスを利用して出力させるために、データ取得雛形クラスの作成
   3. データ取得のインスタンスを利用して、DBへクエリを流すクラスをインスタンス化してクエリ送信
   4. 取得したデータの表示が実現
3. ログインフォームからクエリ取得をするための入力IDの取得
   1. formの作成
      1. inputのIDとパスを受け取って、コントーラーのloginのPOSTメソッドに渡す
      2. postメソッドの中で使用する、loginのコールバック関数を定義する
      3. login関数では、inputのidをuserクエリに渡してDBに存在するか確認
      4. 確認できれば、パスワードの認証に映る
         phpメソッドのpassword_verify('パスワード', '取得したユーザーが持っているパスワードと比較する')
      5. パスワードが一致したら、セッションにデータを保持させる
         そのために、トップページにはsession_start();の関数を実行しておく必要がある
         DB操作を行った後に実行しないとエラーになってしまうため、読み込み場所を注意する

4. パスワードのハッシュ化
   1. 特殊な計算手順で、固定長のランダム文字列に見えるハッシュ値を得ること
   2. ハッシュ関数
      phpデフォルトハッシュ関数　→ bcrypt

## 登録機能
1. viewsのregister.phpにformを作成する
2. ログイン機能と同じようにDB操作のクラスを利用する
3. viewsで判断するために、関数から真偽値を返す
4. 登録用関数では、ユーザーに被りがないかを判断するため一度ユーザーを検索する必要がある
   検索にヒットしたら、falseを返して関数を完了させる
   検索にヒットしなければ、登録用の関数に進める
5. パスワードのハッシュ化
   password_hash('ハッシュ化する文字列','アルゴリズム');
   ※このPHPメソッドを利用することでソルトを含めてハッシュ化してくれる。

### ログイン状態の保持

$_SESSION['user'] = $userとして管理してあげる

1. ログイン成功のページ遷移
   1. redirect処理を実装する
      header('Location: 転送したいパス');このように記述することで転送が可能になる
   2. 一つ前のリクエストパスを取得するメソッド
      $_SERVER['HTTP_REFERER'];これで取得可能


### エラーメッセージの表示
今までの認証成功・失敗、ログインを促すメッセージの処理をクラス化して管理しやすくする。
1. controllersで呼び出されるときには、タイプとメッセージを引数として、メッセージを格納するクラスのpushメソッドを作成
2. pushメソッドはメッセージクラスのsession情報を確認して、配列になっていなければ空の配列を入れて初期化する
3. その初期化するスタチックメソッドをinitメソッドを作成
4. アブストラクトクラスのsetSessionでセッションネームにメッセージのタイプごとのキーに対して初期化を行う
5. またpushメソッドに戻ってきて、初期化されたセッション情報を変数に格納する
6. 引数で受け取ったタイプのキーに対して、引数で受け取ったメッセージを格納する


### 例外処理の実装
1. 例外処理は、影響範囲が大きいところから始める。


### 入力値のチェック

1. 入力内容が空かどうか
2. DB制約に応じた内容になるようにチェック
   1. 文字数　strlen(チェックしたい文字);半角文字数をカウントする。全角は２文字としてカウントする
      ※ mb_strlen(文字列)こちらは純粋に文字数をカウントする　日本語のチェックにも使える
   2. 半角英数字　　pleg_match(チェックする正規表現,チェックする文字);
   3. falseをリターンしてやれば、結果としてfalseがかえるようになる